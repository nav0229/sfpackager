<!--
 - Created by kgabus on 11/4/2019.
 -->

<apex:page id="s3UploadTestPage" controller="s3uploadTest">
    <input type="file" id = 'testInput'></input>
    <button onclick="uploadFilesToS3()">Upload</button>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        function uploadFilesToS3() {
            $ = jQuery.noConflict();
//		    debugger;
			let files = $('#testInput')[0].files;
            let file = files[0];
            let fileName = file.name;

   			console.log('file name: ', fileName);

			Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.s3uploadTest.getPresignedUrl}', fileName,
                function(res, event) {
                    if (event.status) {
                        console.log('returned url: ', res);

                        $.ajax({
                            url: res,
                            type: 'PUT',
                            //contentType: 'text/plain',
                            contentType: 'application/rtf',
                            processData: false,
                            data: file,
                            success: function () {
//                                alert('success');

                            }
                        })

                    } else if (event.type === 'exception') {
                        console.log("exception: ", event.message);
                    } else {
                        console.log("exception: ", event.message);
                    }
                },
                {escape: true}
            );
		}
    </script>
</apex:page>